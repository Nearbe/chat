{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://github.com/Qwen3.5-35B-Bridge-Agent/agents/skill-schema.json",
  "title": "Agent Skill Configuration Schema",
  "description": "JSON Schema для валидации YAML-конфигурации AI-агентов (LangGraph/AutoGen compatible)",
  "$defs": {
    "agent_metadata": {
      "type": "object",
      "properties": {
        "name": {
          "type": "string",
          "pattern": "^[a-z][a-z0-9_]*$",
          "description": "Идентификатор агента (snake_case, начинается с буквы)"
        },
        "title": {
          "type": "string",
          "minLength": 1,
          "description": "Человекочитаемое название роли"
        },
        "version": {
          "$ref": "#/definitions/version_string",
          "description": "Версия конфигурации (semantic versioning)"
        },
        "department": {
          "type": "string",
          "enum": [
            "product",
            "engineering",
            "design",
            "qa",
            "devops",
            "cto",
            "hr"
          ],
          "description": "Департамент, к которому относится агент"
        },
        "access": {
          "$ref": "#/definitions/access_level",
          "default": "read",
          "description": "Уровень доступа к файлам проекта"
        }
      },
      "required": [
        "name",
        "title",
        "version",
        "department"
      ],
      "additionalProperties": false
    },
    "triggers_config": {
      "type": "object",
      "properties": {
        "keywords": {
          "type": "array",
          "items": {
            "$ref": "#/definitions/trigger_keyword"
          },
          "minItems": 1,
          "description": "Ключевые слова для активации агента"
        },
        "domains": {
          "type": "array",
          "items": {
            "$ref": "#/definitions/domain_name"
          },
          "minItems": 1,
          "description": "Домены экспертизы агента"
        }
      },
      "required": [
        "keywords",
        "domains"
      ],
      "additionalProperties": false
    },
    "organization_config": {
      "type": "object",
      "properties": {
        "reports_to": {
          "$ref": "#/definitions/agent_role",
          "description": "Роль, перед которой отчитывается агент"
        },
        "coordinates_with": {
          "type": "array",
          "items": {
            "$ref": "#/definitions/collaboration_config"
          },
          "description": "С кем координируется агент"
        }
      },
      "required": [
        "reports_to",
        "coordinates_with"
      ],
      "additionalProperties": false
    },
    "collaboration_config": {
      "type": "object",
      "properties": {
        "agent_type": {
          "$ref": "#/definitions/agent_role",
          "description": "Тип агента для координации"
        },
        "purpose": {
          "type": "string",
          "minLength": 1,
          "description": "Цель взаимодействия"
        }
      },
      "required": [
        "agent_type",
        "purpose"
      ],
      "additionalProperties": false
    },
    "responsibilities_config": {
      "type": "object",
      "patternProperties": {
        "^[a-z][a-z0-9_]*$": {
          "$ref": "#/definitions/responsibility_block"
        }
      },
      "additionalProperties": false
    },
    "responsibility_block": {
      "type": "object",
      "properties": {
        "description": {
          "type": "string",
          "minLength": 1,
          "description": "Описание обязанности"
        },
        "tasks": {
          "type": "array",
          "items": {
            "$ref": "#/definitions/task_item"
          },
          "description": "Список задач в рамках обязанности"
        }
      },
      "required": [
        "description",
        "tasks"
      ],
      "additionalProperties": false
    },
    "task_item": {
      "oneOf": [
        {
          "type": "string",
          "minLength": 1,
          "description": "Простая задача (строка)"
        },
        {
          "$ref": "#/definitions/task_object"
        }
      ]
    },
    "task_object": {
      "type": "object",
      "properties": {
        "id": {
          "type": "string",
          "description": "Идентификатор задачи"
        },
        "action": {
          "type": "string",
          "minLength": 1,
          "description": "Действие по задаче"
        },
        "details": {
          "$ref": "#/definitions/task_details"
        }
      },
      "required": [
        "action"
      ],
      "additionalProperties": false
    },
    "task_details": {
      "oneOf": [
        {
          "type": "array",
          "items": {
            "$ref": "#/definitions/detail_item"
          }
        },
        {
          "type": "object"
        }
      ]
    },
    "detail_item": {
      "oneOf": [
        {
          "type": "string",
          "minLength": 1
        },
        {
          "$ref": "#/definitions/detail_object"
        }
      ]
    },
    "detail_object": {
      "type": "object",
      "properties": {
        "name": {
          "type": "string",
          "minLength": 1
        },
        "value": {}
      },
      "required": [
        "name"
      ]
    },
    "workflow_step": {
      "$ref": "#/definitions/task_object"
    },
    "use_case_config": {
      "type": "object",
      "properties": {
        "name": {
          "type": "string",
          "minLength": 1,
          "description": "Название use case"
        },
        "trigger_phrase": {
          "type": "string",
          "minLength": 1,
          "description": "Фраза, которая активирует этот сценарий"
        },
        "algorithm": {
          "$ref": "#/definitions/algorithm_config"
        }
      },
      "required": [
        "name",
        "trigger_phrase",
        "algorithm"
      ],
      "additionalProperties": false
    },
    "algorithm_config": {
      "type": "object",
      "properties": {
        "steps": {
          "$ref": "#/definitions/step_array"
        }
      },
      "required": [
        "steps"
      ]
    },
    "step_array": {
      "type": "array",
      "items": {
        "$ref": "#/definitions/workflow_step"
      }
    },
    "constraint_config": {
      "oneOf": [
        {
          "$ref": "#/definitions/hard_constraint"
        },
        {
          "$ref": "#/definitions/soft_constraint"
        }
      ]
    },
    "hard_constraint": {
      "type": "object",
      "properties": {
        "id": {
          "type": "string",
          "pattern": "^h\\d+$",
          "description": "Идентификатор (h1, h2, ...)",
          "example": "h1"
        },
        "rule": {
          "type": "string",
          "minLength": 1,
          "description": "Формулировка правила"
        },
        "severity": {
          "$ref": "#/definitions/severity_level",
          "const": "CRITICAL",
          "default": "CRITICAL"
        },
        "enforcement": {
          "type": "string",
          "minLength": 1,
          "description": "Механизм enforcement правила"
        }
      },
      "required": [
        "id",
        "rule",
        "severity",
        "enforcement"
      ]
    },
    "soft_constraint": {
      "$ref": "#/definitions/hard_constraint"
    },
    "success_metric_config": {
      "oneOf": [
        {
          "$ref": "#/definitions/quantitative_metric"
        },
        {
          "$ref": "#/definitions/qualitative_metric"
        }
      ]
    },
    "quantitative_metric": {
      "type": "object",
      "properties": {
        "name": {
          "type": "string",
          "minLength": 1,
          "description": "Название метрики"
        },
        "description": {
          "type": "string",
          "minLength": 1,
          "description": "Описание метрики"
        },
        "target_value": {
          "$ref": "#/definitions/target_value_pattern"
        },
        "measurement_method": {
          "type": "string",
          "minLength": 1,
          "description": "Как измеряется метрика"
        }
      },
      "required": [
        "name",
        "description",
        "target_value",
        "measurement_method"
      ]
    },
    "qualitative_metric": {
      "$ref": "#/definitions/quantitative_metric"
    },
    "phase_config": {
      "type": "object",
      "properties": {
        "phase_number": {
          "type": "integer",
          "minimum": 1,
          "description": "Номер фазы (начиная с 1)"
        },
        "name": {
          "type": "string",
          "minLength": 1,
          "description": "Название фазы"
        },
        "duration": {
          "$ref": "#/definitions/duration_pattern",
          "description": "Длительность фазы"
        },
        "tasks": {
          "$ref": "#/definitions/task_array"
        },
        "deliverables": {
          "$ref": "#/definitions/deliverable_array"
        }
      },
      "required": [
        "phase_number",
        "name",
        "duration",
        "tasks",
        "deliverables"
      ]
    },
    "contact_config": {
      "type": "object",
      "properties": {
        "role": {
          "$ref": "#/definitions/agent_role"
        },
        "purpose": {
          "type": "string",
          "minLength": 1,
          "description": "Когда обращаться к этой роли"
        }
      },
      "required": [
        "role",
        "purpose"
      ]
    },
    "documentation_reference_config": {
      "$ref": "#/definitions/contact_config"
    },
    "version_history_config": {
      "type": "object",
      "properties": {
        "current_version": {
          "$ref": "#/definitions/version_string"
        },
        "created_at": {
          "$ref": "#/definitions/date_pattern"
        },
        "last_modified": {
          "$ref": "#/definitions/date_pattern"
        }
      },
      "required": [
        "current_version",
        "created_at",
        "last_modified"
      ]
    },
    "changelog_entry_config": {
      "type": "object",
      "properties": {
        "version": {
          "$ref": "#/definitions/version_string"
        },
        "date": {
          "$ref": "#/definitions/date_pattern"
        },
        "changes": {
          "type": "array",
          "items": {
            "type": "string",
            "minLength": 1
          }
        }
      },
      "required": [
        "version",
        "date",
        "changes"
      ]
    }
  },
  "definitions": {
    "access_level": {
      "type": "string",
      "enum": [
        "read",
        "write",
        "full"
      ],
      "default": "read"
    },
    "trigger_keyword": {
      "type": "string",
      "minLength": 1,
      "maxLength": 50
    },
    "domain_name": {
      "type": "string",
      "minLength": 1,
      "maxLength": 50
    },
    "agent_role": {
      "type": "string",
      "pattern": "^[a-z][a-z0-9_]*$"
    },
    "severity_level": {
      "type": "string",
      "enum": [
        "CRITICAL",
        "HIGH",
        "MEDIUM",
        "LOW"
      ]
    },
    "target_value_pattern": {
      "oneOf": [
        {
          "type": "string",
          "pattern": "^\\d+%$",
          "description": "Процентное значение (например, '90%')"
        },
        {
          "type": "number",
          "minimum": 0,
          "maximum": 1
        }
      ]
    },
    "duration_pattern": {
      "type": "string",
      "pattern": "^\\d+ (неделя|недели|месяц|месяца|месяцев|день|дня|дней)$"
    },
    "version_string": {
      "type": "string",
      "pattern": "^\\d+\\.\\d+\\.\\d+$"
    },
    "date_pattern": {
      "type": "string",
      "format": "date",
      "pattern": "^\\d{4}-\\d{2}-\\d{2}$"
    },
    "task_array": {
      "type": "array",
      "items": {
        "$ref": "#/definitions/task_item"
      }
    },
    "deliverable_array": {
      "type": "array",
      "items": {
        "type": "string",
        "minLength": 1
      }
    }
  },
  "$ref": "#/definitions/agent_config_root"
}
