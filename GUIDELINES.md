# Руководство по разработке проекта Chat

## Общие положения
Данный проект представляет собой мобильное приложение для взаимодействия с LLM моделями через API LM Studio. Проект написан на Swift с использованием SwiftUI и SwiftData.

## Структура проекта
- `App/`: Точка входа в приложение и глобальная конфигурация.
- `Core/`: Универсальные типы (`AnyCodable`) и расширения.
- `Data/`: Настройка SwiftData (`PersistenceController`).
- `Design/`: Дизайн-система (цвета, отступы, типографика).
- `Models/`: Модели данных, разделенные на бизнес-модели и API-модели (в `Models/LMStudio`).
- `Services/`: Сервисы для авторизации (`Auth`), сети (`Network`), логики чата (`Chat`) и системных функций.
- `ViewModels/`: Логика UI и связь между View и Services.

## Архитектурные принципы
Проект следует принципам чистой архитектуры и SOLID:
- **Dependency Injection**: Сервисы внедряются во ViewModel и другие сервисы через инициализаторы или EnvironmentObject.
- **Single Responsibility**: 
    - `ChatService` отвечает только за API.
    - `ChatSessionManager` отвечает только за сохранение данных.
    - `NetworkMonitor` отвечает только за статус сети.
    - `ChatViewModel` управляет только состоянием UI.
- **AuthorizationProvider**: Вся логика авторизации изолирована через протоколы.
- `Views/`: SwiftUI компоненты и экраны.

## Важные файлы
- `.junie/instructions.md`: Специальные инструкции для ИИ-помощников.
- `.junie/context.json`: Архитектурная карта проекта для быстрого погружения.
- `setup.sh`: Скрипт подготовки проекта (XcodeGen + SwiftGen).
- `check.sh`: Техническая проверка (Lint + Build + Test + Commit) для разработчика/ИИ. Использует симулятор для избежания запросов пароля Keychain.
- `ship.sh`: Доставка продукта (Release Build + Deploy) для главного потребителя. Должен запускаться ПОСЛЕ `check.sh`. Использует физическое устройство.

## Стандарты разработки
- Комментарии и документация пишутся на **русском языке**.
- Любые изменения в моделях API должны быть согласованы со спецификацией LM Studio v1.
- Новые UI компоненты должны использовать константы из `AppColors`, `AppSpacing` и `AppTypography`.
- Секретные данные (токены) хранятся **только** в Keychain.
- **Ограничения Personal Team**: Разработка ведется с учетом лимитов персональной команды Apple Developer. Недопустимо использование CloudKit, Push Notifications, In-App Purchases, Apple Pay и других сервисов, требующих платной подписки Apple Developer Program. Автоматизация (`check.sh`) настроена на использование симуляторов без подписания кода, чтобы избежать запросов пароля.
## Порядок внесения изменений (Change Management)
Чтобы проект оставался поддерживаемым, а информация в нем актуальной, при внесении изменений следуйте этим шагам:
1. **Обновление структуры папок или ключевых файлов**:
   - Если вы добавляете, удаляете или перемещаете папку/файл, обязательно отразите это в `GUIDELINES.md` в разделе "Структура проекта".
   - Обновите техническую карту в `.junie/context.json`, если изменились ключевые точки входа (`key_entry_points`).
2. **Изменение архитектурных подходов**:
   - Если в проект внедряется новая технология или меняется способ работы с существующей (например, замена SwiftData на CoreData), обновите `.junie/instructions.md` и `GUIDELINES.md`.
3. **Добавление нового функционала**:
   - Новые функции должны сопровождаться комментариями на русском языке (Docstrings).
   - Если функционал требует настройки окружения, обновите `setup.sh` или `check.sh`.
4. **Синхронизация документации**:
   - После завершения работы проверьте, что `GUIDELINES.md`, `.junie/context.json` и `.junie/instructions.md` согласованы между собой.
5. **Проверки качества и коммит**:
   - Перед отправкой изменений ОБЯЗАТЕЛЬНО выполните `./check.sh`.
   - Если требуется доставить продукт для проверки, выполните `./ship.sh` ПОСЛЕ `./check.sh`.
   - Что делает `./check.sh`:
     - `xcodegen` (генерация проекта)
     - `swiftlint` (проверка стиля)
     - `swiftgen` (генерация ассетов)
     - `xcodebuild ... test` (прохождение всех тестов)
     - **Автоматический коммит и push**
## Стек технологий
- Swift 6.0
- SwiftUI
- SwiftData
- XcodeGen
- SwiftGen
- Factory (Dependency Injection)
- Pulse (Logging & Network Monitoring)
- Apple Security framework (Keychain)
- SwiftLint (Code Quality)
