# Паттерны анализа фич

## Введение

Этот документ описывает типовые паттерны, которые используются при анализе идей фич в проекте Chat iOS.

> **⚠️ Важно**: Проект разрабатывается **командой AI-агентов**. При использовании паттернов учитывай:
> - Все роли выполняют AI-агенты (client_developer, server_developer, etc.)
> - Используй специфику проекта: SwiftUI + SwiftData + MVVM
> - Учитывай AI-процессы: `swift run scripts check`, `swift run scripts ship`
> - Language: Русский для документации и коммитов

## Паттерн 1: MVP (Minimum Viable Product)

При анализе больших фич всегда предлагайте минимально жизнеспособную версию.

### Пример

Идея: "Полноценная интеграция с iCloud"

**Анализ:**

- MVP: Синхронизация только истории чатов через CloudKit
- Фаза 2: Синхронизация настроек
- Фаза 3: Синхронизация медиафайлов

### Когда использовать

- Фича требует значительных ресурсов
- Есть возможность итеративной реализации
- Пользователи могут получить ценность от части функционала

## Паттерн 2: Фазирование

Разбивайте фичу на логические фазы реализации.

### Структура фазирования

1. **Фаза 1: Core** - Базовый функционал
2. **Фаза 2: Enhancement** - Улучшения и оптимизации
3. **Фаза 3: Polish** - Доработки UX, performance

### Пример

Идея: "Темная тема"

- Фаза 1: Base dark mode для основных экранов
- Фаза 2: Адаптация всех компонентов
- Фаза 3: Системная интеграция (автоматическое переключение)

## Паттерн 3: Feature Flag

Для рискованных фич предлагайте использование Feature Flags.

### Когда использовать

- Фича может сломать существующий функционал
- Нужен A/B тестинг
- Постепенное rollout

### Пример реализации

```swift
struct AppConfig {
    static let isDarkThemeEnabled = FeatureFlag(key: "dark_theme", default: false)
    static let isVoiceMessagesEnabled = FeatureFlag(key: "voice_messages", default: false)
}
```

## Паттерн 4: Reverse Engineering

Если фича сложная, опишите как она будет выглядеть "изнутри".

### Вопросы для анализа

1. Какие данные нужны?
2. Откуда они приходят?
3. Как обрабатываются?
4. Как хранятся?
5. Как отображаются?

### Пример

Идея: "Экспорт чата в PDF"

1. Данные: Message модели из SwiftData
2. Источник: ChatSession.messages relationship
3. Обработка: Формирование структуры документа
4. Хранение: Временный файл или UIActivityController
5. Отображение: PDF viewer или share sheet

## Паттерн 5: Dependency Mapping

Всегда идентифицируйте зависимости фичи.

### Типы зависимостей

- **Внутренние**: Другие части приложения
- **Внешние**: API, сторонние сервисы
- **Инфраструктурные**: CloudKit, Push Notifications

### Пример карты зависимостей

```
Voice Messages Feature
├── Internal
│   ├── AudioRecorder (новый компонент)
│   ├── Message model (расширение)
│   └── ChatViewModel (изменения)
├── External
│   └── LM Studio API (новая функциональность)
└── Infrastructure
    └── Файловое хранилище
```

## Паттерн 6: Risk Assessment Matrix

Оценивайте риски по двум осям.

### Матрица рисков

|                         | Низкое влияние | Среднее влияние | Высокое влияние |
|-------------------------|----------------|-----------------|-----------------|
| **Высокая вероятность** | Medium         | High            | Critical        |
| **Средняя вероятность** | Low            | Medium          | High            |
| **Низкая вероятность**  | Low            | Low             | Medium          |

### Категории рисков

1. **Технические**: Архитектура, performance, совместимость
2. **Безопасность**: Уязвимости, защита данных
3. **UX**: Сложность, доступность
4. **Бизнес**: ROI, приоритет

## Паттерн 7: Alternative Evaluation

Всегда предлагайте альтернативы.

### Типы альтернатив

1. **Отложенная реализация** - Сделать позже
2. **Упрощенная версия** - MVP вместо полной
3. **Альтернативная технология** - Другой подход
4. **Внешнее решение** - Использовать сторонний сервис

### Пример

Идея: "Собственный OCR для изображений"

Альтернативы:

1. Использовать Vision framework (встроенный)
2. Использовать стороннее API (Google ML Kit)
3. Отложить до появления нативного решения

## Паттерн 8: User Story Mapping

Описывайте фичу через User Stories.

### Шаблон

```
As a [type of user]
I want to [action]
So that [benefit]
```

### Пример

Идея: "Темная тема"

```
As a user
I want to use dark theme
So that I can comfortably use the app at night
```

## Паттерн 9: Technical Spike

Для неизученных технологий предлагайте spike.

### Когда использовать

- Новая технология
- Неизвестные ограничения
- Proof of Concept нужен

### Пример

Идея: "WebRTC для видеозвонков"

- Spike 1: Изучить WebRTC интеграцию (2 дня)
- Spike 2: Прототип передачи видео (3 дня)
- Decision point: Продолжать или использовать WebSocket?

## Паттерн 10: Stakeholder Alignment

Определяйте заинтересованные стороны.

### Типы стейкхолдеров

- **Product** - Владелец продукта
- **Engineering** - Разработчики
- **Design** - Дизайнеры
- **QA** - Тестировщики
- **Operations** - Деплой и мониторинг

### Вопросы для каждого

| Стейкхолдер | Ключевой вопрос                 |
|-------------|---------------------------------|
| Product     | Какую проблему решаем?          |
| Engineering | Как это реализовать технически? |
| Design      | Как это должно выглядеть?       |
| QA          | Как это протестировать?         |
| Operations  | Как это деплоить и мониторить?  |
