# Дизайн-анализ iOS проекта Chat

> **Дата анализа:** 24 февраля 2026  
> **Аналитик:** Designer Agent  
> **Версия проекта:** Текущая (на основе SwiftGen 6.6.3)

---

## Содержание

1. [Визуальный дизайн](#1-визуальный-дизайн)
2. [UI-компоненты](#2-ui-компоненты)
3. [Пользовательский интерфейс](#3-пользовательский-интерфейс)
4. [Рекомендации по улучшению](#4-рекомендации-по-улучшению)

---

## 1. Визуальный дизайн

### 1.1 Цветовая палитра

Проект использует централизованную дизайн-систему цветов в файле `Design/Colors.swift`.

#### Основные цвета (Primary Colors)

| Название | Значение | Применение |
|----------|----------|------------|
| **Primary Orange** | `#FF9F0A` (RGB: 255, 159, 10) | Основной акцентный цвет, кнопки |
| **Primary Blue** | `#007AFF` (RGB: 0, 122, 255) | Вторичный акцент, ссылки |

#### Семантические цвета (Semantic Colors)

| Название | Применение |
|----------|------------|
| **Success** | Подтверждения, успешные операции (`#34C759`) |
| **Error** | Ошибки, опасные действия (`#FF3B30`) |
| **Warning** | Предупреждения (`#FF9500`) |
| **Info** | Информационные сообщения (`#007AFF`) |

#### Нейтральные цвета (Neutral Colors)

| Название | Значение | Применение |
|----------|----------|------------|
| **textPrimary** | `Color.primary` (системный) | Основной текст |
| **textSecondary** | `Color.secondary` (системный) | Вторичный текст |
| **textTertiary** | `Color(uiColor: .tertiaryLabel)` | Третичный текст |
| **backgroundPrimary** | `Color(uiColor: .systemBackground)` | Основной фон |
| **backgroundSecondary** | `Color(uiColor: .systemGroupedBackground)` | Группированный фон |
| **backgroundTertiary** | `Color(uiColor: .systemGray6)` | Третичный фон |
| **separator** | `Color(uiColor: .separator)` | Разделители |

#### Статус цвета (Connection Status)

| Название | Цвет | Применение |
|----------|------|------------|
| **connected** | Зелёный | Успешное подключение |
| **disconnected** | Серый | Нет подключения |
| **connectionError** | Красный | Ошибка подключения |
| **connecting** | Оранжевый | Процесс подключения |

#### Системные цвета

Проект использует системные цвета iOS (`systemGray4`, `systemGray5`, `systemGray6`) для обеспечения адаптации под светлую/тёмную тему.

### 1.2 Типографика

Проект использует системные шрифты iOS с определёнными стилями в `Design/Typography.swift`.

#### Заголовки (Headlines)

| Стиль | Шрифт | Применение |
|-------|-------|------------|
| **largeTitle** | `.largeTitle.bold()` | Главные заголовки |
| **title** | `.title.bold()` | Заголовки секций |
| **title2** | `.title2` | Подзаголовки |
| **title3** | `.title3` | Малые заголовки |
| **headline** | `.headline.bold()` | Акцентные заголовки |
| **iconLarge** | `Font.system(size: 60)` | Большие иконки |
| **iconMedium** | `Font.system(size: 32)` | Кнопки управления |

#### Основной текст (Body)

| Стиль | Шрифт | Применение |
|-------|-------|------------|
| **body** | `.body` | Основной текст |
| **bodyBold** | `.body.bold()` | Жирный основной текст |
| **bodySmall** | `.body` | Уменьшенный текст |

#### Подписи (Callout & Caption)

| Стиль | Шрифт | Применение |
|-------|-------|------------|
| **callout** | `.callout` | Подписи |
| **calloutBold** | `.callout.bold()` | Жирные подписи |
| **caption** | `.caption` | Подписи |
| **captionBold** | `.caption.bold()` | Жирные подписи |
| **caption2** | `.caption2` | Малые подписи |

#### Специальные стили

| Стиль | Шрифт | Применение |
|-------|-------|------------|
| **message** | `.body` | Текст сообщения |
| **timestamp** | `.caption2` | Время сообщения |
| **modelName** | `.caption2` | Имя модели |
| **input** | `.body` | Текст ввода |

#### ViewModifiers для типографики

Проект предоставляет кастомные модификаторы для применения стилей:
- `TitleStyle` — стиль заголовка
- `SubtitleStyle` — стиль подзаголовка
- `MessageStyle` — стиль сообщения (с поддержкой isUser)
- `TimestampStyle` — стиль временной метки

### 1.3 Отступы и размеры

Система отступов построена на 8pt сетке (`Design/Spacing.swift`).

#### Базовые отступы (Base Spacing)

| Название | Значение | Применение |
|----------|----------|------------|
| **xxs** | 4pt | Минимальные отступы |
| **xs** | 8pt | Маленькие отступы |
| **sm** | 12pt | Средне-маленькие |
| **md** | 16pt | Стандартные |
| **lg** | 24pt | Большие |
| **xl** | 32pt | Очень большие |
| **xxl** | 48pt | Максимальные |

#### Компонентные отступы (Component Specific)

| Название | Значение | Применение |
|----------|----------|------------|
| **messageHorizontal** | 16pt | Отступ сообщения по горизонтали |
| **messageVertical** | 12pt | Отступ сообщения по вертикали |
| **messageSpacing** | 8pt | Расстояние между сообщениями |
| **inputPadding** | 8pt | Отступ в input области |
| **listItemPadding** | 12pt | Отступ в list |
| **formSectionPadding** | 16pt | Padding секции в форме |

#### Corner Radius

| Название | Значение | Применение |
|----------|----------|------------|
| **small** | 8pt | Кнопки, поля ввода |
| **medium** | 12pt | Карточки, пузыри сообщений |
| **large** | 18pt | Модальные окна |
| **bubbleRadius** | 18pt | Радиус пузыря сообщения |
| **inputRadius** | 18pt | Радиус инпута |

#### Размеры иконок

| Название | Значение | Применение |
|----------|----------|------------|
| **iconSmall** | 16pt | Маленькие иконки |
| **iconMedium** | 32pt | Кнопки управления |
| **iconLarge** | 60pt | Пустые состояния |
| **iconXLarge** | 80pt | Очень большие иконки |
| **statusIcon** | 10pt | Индикатор статуса |

#### Размеры кнопок и полей ввода

| Название | Значение | Применение |
|----------|----------|------------|
| **buttonHeight** | 44pt | Высота кнопки |
| **buttonMinWidth** | 80pt | Минимальная ширина кнопки |
| **inputHeight** | 44pt | Высота text field |
| **textEditorMinHeight** | 100pt | Минимальная высота text editor |

### 1.4 Темная/светлая тема

Управление темой осуществляется через `ThemeManager` (`Services/ThemeManager.swift`):

- **colorScheme** — переключение между `.light` и `.dark`
- **accentColor** — динамический цвет акцента (настраивается пользователем)
- Поддержка адаптации под системные настройки через `.preferredColorScheme()`

---

## 2. UI-компоненты

### 2.1 Основные компоненты

#### PrimaryButtonStyle

Кастомная кнопка с эффектом нажатия (`Design/PrimaryButtonStyle.swift`):
- Поддержка destructive-режима
- Анимация при нажатии (opacity 0.8, scale 0.98)
- Высота: 44pt, минимальная ширина: 80pt
- Радиус углов: 8pt
- Шрифт: `AppTypography.callout.bold()`

#### MessageBubble

Пузырь сообщения (`Features/Chat/Components/MessageBubble.swift`):
- Адаптивный дизайн под пользователя/AI
- Фон: акцентный цвет для пользователя, `systemGray5` для AI
- Радиус: 18pt
- Поддержка контекстного меню (копирование, редактирование, удаление)
- Отображение имени модели и времени
- Индикатор генерации (ProgressView)

#### MessageInputView

Область ввода сообщения (`Features/Chat/Components/MessageInputView.swift`):
- TextField с поддержкой многострочного ввода (lineLimit: 1-10)
- Кнопка отправки/остановки генерации
- Статус-бар с информацией о подключении
- Радиус поля ввода: 18pt
- Border: 1pt `systemGray4`

#### StatusIndicator

Индикатор статуса подключения (`Features/Common/Components/StatusIndicator.swift`):
- 4 состояния: connected, disconnected, connecting, error
- Цветной индикатор (8pt круг)
- Текстовое описание статуса
- Использует `AppTypography.caption`

#### StatusBadgeView

Бейдж статуса (используется в `MessageInputView`):
- Компонент для отображения состояния подключения
- Интегрирован с StatusIndicator

#### ChatMessagesView

Список сообщений (`Features/Chat/Components/ChatMessagesView.swift`):
- Отображение списка сообщений
- Поддержка tool calls
- Отображение статистики генерации
- Свайп-действия для удаления/редактирования

#### ContextBar

Панель контекста (`Features/Chat/Components/ContextBar.swift`):
- Отображение контекстной информации
- Используется в чате для доп. информации

#### ThinkingBlock

Блок "думания" AI (`Features/Chat/Components/ThinkingBlock.swift`):
- Анимация процесса генерации ответа
- Использует `ThemeManager.primaryOrange`

#### ToolCallView & ToolsStatusView

Компоненты для отображения вызовов инструментов:
- `ToolCallView` — отображение отдельных tool calls
- `ToolsStatusView` — статус выполнения инструментов

#### GenerationStatsView

Отображение статистики генерации (`Features/Chat/Components/GenerationStatsView.swift`):
- Показывает метрики генерации (токены, время и т.д.)

### 2.2 Экраны

#### ChatView

Главный экран чата (`Features/Chat/Views/ChatView.swift`):
- NavigationStack с навигационной панелью
- Три состояния:
  1. Экран авторизации (tokenRequiredView)
  2. Пустое состояние (emptyStateView)
  3. Список сообщений с полем ввода
- Инструменты в toolbar:
  - История чатов
  - Выбор модели
  - Индикатор подключения
  - Переключатель MCP-инструментов
  - Экспорт в Markdown

#### HistoryView

Экран истории чатов (`Features/History/Views/HistoryView.swift`):
- Список сессий с сортировкой по дате
- Поиск по чатам и сообщениям
- Свайп-удаление
- Пустое состояние
- Стиль: `.insetGrouped`

#### ModelPicker

Экран выбора модели (`Features/Settings/Views/ModelPicker.swift`):
- Список доступных моделей
- Выбор модели с подтверждением
- Пустое состояние с инструкцией
- Стиль: `.insetGrouped`

#### SessionRowView

Строка сессии в истории (`Features/History/Components/SessionRowView.swift`):
- Отображение заголовка и превью последнего сообщения
- Дата обновления
- Имя модели

#### ModelRowView

Строка модели в picker (`Features/Settings/Components/ModelRowView.swift`):
- Название модели
- Индикатор выбора

### 2.3 Специальные компоненты

#### ShieldView

Интерактивный 3D-щит для ввода токена (`Features/Common/Components/ShieldView.swift`):
- Используется на экране авторизации
- Анимация взаимодействия

#### CopyButton

Кнопка копирования (`Features/Common/Components/CopyButton.swift`):
- Копирование текста в буфер обмена
- Визуальная обратная связь

---

## 3. Пользовательский интерфейс

### 3.1 Навигационная структура

```
ChatView (NavigationStack)
├── ChatMessagesView (основной контент)
│   ├── MessageBubble (повторяющийся)
│   ├── ThinkingBlock
│   ├── ToolCallView
│   └── GenerationStatsView
├── MessageInputView (внизу)
└── Toolbar
    ├── Кнопка истории (leading)
    ├── Выбор модели (center)
    ├── Индикатор подключения
    └── MCP-инструменты (trailing)
        └── Кнопка экспорта
```

Модальные окна (Sheets):
- HistoryView — история чатов
- ModelPicker — выбор модели
- ConsoleView — отладочная консоль Pulse
- ShareSheet — экспорт в Markdown
- Sheet редактирования сообщения

### 3.2 Взаимодействия

#### Жесты
- **Tap** — базовое взаимодействие (выбор, нажатие кнопок)
- **Double tap** — открытие отладочной консоли Pulse (на заголовке)
- **Long press / Context menu** — действия с сообщениями
- **Swipe** — удаление сессий в истории
- **Tap outside** — закрытие клавиатуры

#### Анимации
- **button press** — scale 0.98, opacity 0.8, duration 0.1s
- **state transitions** — используется стандартная анимация SwiftUI
- **sheet presentations** — стандартные модальные переходы

### 3.3 Состояния интерфейса

#### Экран чата
1. **Требуется авторизация** — 3D щит для ввода токена
2. **Пустое состояние** — приглашение начать разговор
3. **Активный чат** — список сообщений с полем ввода
4. **Генерация** — индикаторы генерации, кнопка остановки

#### История
1. **Пусто** — нет сохранённых чатов
2. **Список** — отображение сессий с поиском
3. **Удаление** — подтверждение через alert

#### Выбор модели
1. **Пусто** — модели не загружены
2. **Список** — доступные модели
3. **Выбрана** — визуальный индикатор

### 3.4 Accessibility

Проект поддерживает accessibility:
- `accessibilityLabel` — описания для VoiceOver
- `accessibilityHint` — подсказки
- `accessibilityIdentifier` — для UI тестирования
- `accessibilityAddTraits(.isHeader)` — заголовки
- `accessibilityHidden` — скрытие декоративных элементов

---

## 4. Рекомендации по улучшению

### 4.1 Цветовая палитра

1. **Добавить больше градаций серого** — текущая система использует только systemGray. Рекомендуется определить фиксированные градации для консистентности:
   - backgroundPrimary: адаптивный (light: white, dark: black)
   - backgroundSecondary: для карточек
   - border: для разделителей

2. **Расширить semantic colors** — добавить цвета для:
   - Наведение/hover (только для macOS)
   - Disabled состояние
   - Loading/Skeleton

3. **Документация цветов** — добавить hex-значения в документацию для удобства использования

### 4.2 Типографика

1. **Добавить tracking/letter-spacing** — для улучшения читаемости на больших экранах

2. **Создать TextStyles enum** — объединить все текстовые стили в единый enum с возможностью комбинирования:
   ```swift
   enum TextStyle {
       case headline
       case body(weight: Font.Weight)
       case caption(size: CGFloat)
   }
   ```

3. **Поддержка Dynamic Type** — убедиться, что все стили корректно реагируют на настройки доступности

### 4.3 Компоненты

1. **Создать библиотеку компонентов** — организовать повторно используемые компоненты в отдельную директорию

2. **Добавить Skeleton View** — для состояний загрузки

3. **Унифицировать corner radius** — убедиться, что все радиусы согласованы (текущие значения: 8, 12, 18pt)

4. **Button Components** — создать полноценную систему кнопок:
   - PrimaryButton ( основное действие)
   - SecondaryButton (альтернативное)
   - DestructiveButton (опасное действие)
   - TextButton (ссылка)
   - IconButton (иконка)

### 4.4 UI/UX

1. **Onboarding** — добавить экран onboarding для новых пользователей

2. **Empty States** — создать унифицированные empty states для всех экранов

3. **Error States** — добавить统一的UI для отображения ошибок (не только через print/alerts)

4. **Loading States** — добавить skeleton или spinner для всех загружаемых данных

### 4.5 Технические улучшения

1. **Figma/Spec документация** — создать актуальную документацию для дизайнеров

2. **Design Tokens** — экспортировать дизайн-систему в формат, понятный для Figma (CSS variables, JSON)

3. **Dark Mode** — проверить контрастность и визуальную привлекательность в тёмной теме

4. **Testing** — добавить визуальные регрессионные тесты (snapshot testing)

---

## Заключение

Проект Chat имеет хорошо структурированную дизайн-систему с чётким разделением на цвета, типографику и отступы. Использование SwiftGen для генерации ассетов обеспечивает type-safety. Однако есть возможности для улучшения:

- **Сильные стороны**: Централизованная система, MVVM архитектура, поддержка accessibility
- **Области для улучшения**: Компонентная библиотека, документация, визуальное тестирование

Рекомендуется продолжить развитие дизайн-системы в направлении создания полноценной библиотеки компонентов с документацией.

---

*Анализ подготовлен Designer Agent*
