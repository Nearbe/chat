# План улучшения проекта Chat

Этот файл содержит детальный список шагов по внедрению новых инструментов, систем и архитектурных улучшений в проект.

## 1. Качество кода и стандарты (Developer Experience)
- [x] **Внедрение SwiftLint**
    - [x] Создать файл конфигурации `.swiftlint.yml` с правилами, подходящими для SwiftUI проекта.
    - [x] Обновить `project.yml`, добавив Build Phase для запуска SwiftLint при сборке.
    - [x] Исправить критические замечания линтера в существующем коде.
- [x] **Настройка SwiftGen**
    - [x] Создать `swiftgen.yml`.
    - [x] Настроить генерацию кода для `Assets.xcassets` (цвета, иконки).
    - [x] Заменить строковые литералы в `AppColors` и других местах на сгенерированные константы.

## 2. Стабильность и тестирование
 - [x] **Добавление Unit и UI тестов**
     - [x] Обновить `project.yml`, добавив таргеты `ChatTests` и `ChatUITests`.
     - [x] Запустить `setup.sh` для перегенерации проекта Xcode.
     - [x] Написать Unit-тесты для `SSEParser` (парсинг потока ответов).
     - [x] Написать Unit-тесты для `HTTPClient` и `NetworkService` (используя моки).
     - [x] Базовый UI-тест для проверки запуска приложения.
     - [x] Разработка инфраструктуры UI-тестов (BaseElement, DSL, BaseTestCase).
     - [x] Внедрение UITestModule в приложение для управления состоянием в тестах.
- [ ] **Проверка покрытия кода (Цель: 100%)**
    - [x] Реализована автоматическая проверка покрытия в `scripts check` (используется `xccov`).
    - [ ] Довести покрытие основного таргета `Chat` до 100% (Текущее: ~50%).
    - [x] Интеграция `xccov` в скрипт автоматизации для анализа `.xcresult`.

## 3. Архитектура и инфраструктура
- [x] **Внедрение Dependency Injection (Factory)**
    - [x] Добавить библиотеку Factory в зависимости (через `project.yml` / SPM).
    - [x] Создать `Container+Registrations.swift` для регистрации сервисов (`ChatService`, `NetworkMonitor`, и т.д.).
    - [x] Рефакторинг `ChatApp.swift` и ViewModels для использования `@Injected`.
- [x] **Система логирования (Pulse)**
    - [x] Интегрировать `Pulse` и `PulseUI` для мониторинга сетевой активности.
    - [x] Добавить логгирование всех запросов в `HTTPClient`.
    - [x] Добавить скрытый жест или кнопку в настройках для вызова консоли Pulse. (Двойной тап по заголовку)

## 4. Локализация и документация
- [x] **Переход на String Catalogs (.stringcatalog)**
    - [x] Создать основной каталог строк.
    - [x] Локализовать интерфейс на английский и русский языки.
- [x] **Добавление документации инструментов**
    - [x] Создана модульная система загрузки документации в `scripts/docs/`.
    - [x] Добавлена документация для: LM Studio, OpenAI API, Factory, Pulse, Ollama, XcodeGen/SwiftGen.
    - [x] Создан мастер-скрипт `download_all_docs.sh` для обновления всех ресурсов.
- [ ] **Генерация документации DocC**
    - [ ] Настроить экспорт документации.
    - [ ] Убедиться, что все публичные интерфейсы имеют корректные Docstrings.

## 5. Функциональные улучшения (UX)
- [x] **Полнотекстовый поиск**
    - [x] Реализовать поиск по сообщениям в `HistoryView` с использованием предикатов SwiftData. (Реализовано через фильтрацию массива)
- [x] **Экспорт диалогов**
    - [x] Добавить возможность экспорта текущей сессии в Markdown файл.

## 6. Производительность и SwiftData
- [x] **Оптимизация поиска и работы с данными**
    - [x] Рефакторинг `HistoryView`: оптимизация фильтрации.
    - [ ] Реализовать механизмы пагинации (fetch limit/offset) для больших списков сообщений.
    - [x] Настроить индексы в моделях SwiftData для ускорения выборок по дате и отправителю.
    - [ ] Оптимизация хранения тяжелых объектов (например, больших контекстов).

## 7. Безопасность и доступность
- [ ] **Защита данных**
    - [ ] Добавить поддержку FaceID / TouchID для разблокировки приложения при входе.
    - [ ] Реализовать функцию "Очистить все данные" (включая Keychain).
- [ ] **Улучшение доступности (Accessibility)**
    - [ ] Проверить и добавить метки VoiceOver для всех кастомных UI компонентов.
    - [ ] Настроить динамические шрифты (Dynamic Type) во всем приложении.

## 8. CI/CD и автоматизация — ПОКА НЕ ДЕЛАЕМ
- [ ] **GitHub Actions Pipeline**
    - [ ] Настроить воркфлоу для автоматического запуска тестов и SwiftLint при создании PR.
    - [ ] Автоматизировать сборку `.ipa` и загрузку в TestFlight через Fastlane.
- [ ] **Автоматизация управления зависимостями**
    - [ ] Настроить регулярную проверку обновлений SPM-библиотек.

## 9. Платформы и UX (User Experience)
- [ ] **Поддержка iPad и macOS** — ПОКА НЕ ДЕЛАЕМ
    - [ ] Адаптировать интерфейс под большие экраны (NavigationSplitView, Sidebar).
    - [ ] Реализовать поддержку горячих клавиш (Keyboard Shortcuts) для отправки сообщений и навигации.
- [ ] **Виджеты и системная интеграция**
    - [ ] Добавить виджеты (Home Screen / Lock Screen) для отображения статуса модели или последних чатов.
    - [ ] Реализовать тактильную отдачу (Haptics) при получении сообщений и нажатии кнопок.

## 10. Расширенная интеграция с моделями
- [ ] **Настройки генерации**
    - [ ] Добавить поддержку системных промптов (System Prompts) для глобальной настройки поведения модели.
    - [ ] Полноценная поддержка Tool Calling (функций) в API LM Studio (если доступно).
    - [ ] Визуализация прогресса загрузки и выгрузки моделей из памяти.

---
*План выполняется последовательно. Каждый пункт требует верификации.*
